---
title: Earn SDK Integration Guide
description: End-to-end guide for integrating Surge Earn market listing and deposit flows.
---

# Earn SDK Integration Guide

This guide shows how to integrate Surge Earn into a web wallet or dApp using TypeScript, JavaScript, and React.

## 1) Install dependencies

```bash
npm install @surge/earn-sdk viem
```

For React hooks:

```bash
npm install react
```

## 2) Create clients

```ts
import { createWalletClient, custom } from "viem";
import { baseSepolia } from "viem/chains";
import {
  SurgeEarnClient,
  SURGE_BASE_SEPOLIA_CONFIG,
  createSurgeEarnPublicClient,
} from "@surge/earn-sdk";

const publicClient = createSurgeEarnPublicClient("https://sepolia.base.org", baseSepolia);

const walletClient = createWalletClient({
  chain: baseSepolia,
  transport: custom(window.ethereum),
});

export const earn = new SurgeEarnClient({
  publicClient,
  walletClient,
  config: SURGE_BASE_SEPOLIA_CONFIG,
});
```

## 3) List markets for wallet users

```ts
const markets = await earn.listMarkets();

// Example rendering payload:
// {
//   id,
//   displayName,
//   marketType,
//   supplyApr,
//   borrowApr,
//   totalAssets,
//   utilization,
//   maxLtv,
// }
```

## 4) Read wallet position

```ts
const address = "0xYourWalletAddress";

const [position, exposures] = await Promise.all([
  earn.getUserPosition(address),
  earn.getUserExposures(address),
]);
```

## 5) Deposit flow

The standard flow is:

1. Check current USDC allowance.
2. If low, approve max.
3. Submit deposit.

```ts
const address = "0xYourWalletAddress";
const amountUsdc = "150";

const allowance = await earn.getAllowance(address);

if (allowance === 0n) {
  await earn.approveMaxUsdc({ account: address, waitForReceipt: true });
}

await earn.deposit({ amountUsdc, account: address, waitForReceipt: true });
```

## 6) Withdraw flow

Withdraw by USDC amount (SDK computes LP tokens):

```ts
await earn.withdrawByUsdc({
  amountUsdc: "50",
  account: "0xYourWalletAddress",
  waitForReceipt: true,
});
```

Or withdraw by explicit LP token amount:

```ts
await earn.withdrawByLpTokens({
  lpTokens: "10.25",
  account: "0xYourWalletAddress",
  waitForReceipt: true,
});
```

## 7) Exposure update flow (fixed markets)

```ts
await earn.setExposure({
  marketId: 2,
  exposurePercent: 35,
  account: "0xYourWalletAddress",
  waitForReceipt: true,
});
```

## 8) React hooks

```tsx
import { useEarnActivity, useEarnMarkets, useEarnPortfolio } from "@surge/earn-sdk/react";

function EarnView({ client, address }: { client: any; address: `0x${string}` }) {
  const { data: markets, loading } = useEarnMarkets(client, { pollIntervalMs: 15000 });
  const { data: portfolio } = useEarnPortfolio(client, address);
  const { data: activity } = useEarnActivity(client, { user: address, limit: 10, pollIntervalMs: 15000 });

  if (loading) return <div>Loading markets...</div>;

  return (
    <div>
      <h2>Markets: {markets.length}</h2>
      <h3>Current Value: {portfolio.position?.currentValue ?? 0}</h3>
      <h4>Recent Activity: {activity.length}</h4>
    </div>
  );
}
```

## 9) Test wallet example

A ready-to-run sample app is available in `surge-earn-sdk/examples/test-wallet`.

It includes:

- Mnemonic create/import
- Mnemonic persistence across page refresh
- Base Sepolia address preview
- Base Sepolia USDC balance display
- Faucet helper panel (copy address + ETH/USDC links)
- Invest flow (approve + deposit via SDK)
- Market listing and recent activity feed

## 10) MetaMask connect helpers (UI-ready)

```ts
import { createWalletClient, custom } from "viem";
import { baseSepolia } from "viem/chains";
import {
  SurgeEarnClient,
  SURGE_BASE_SEPOLIA_CONFIG,
  createSurgeEarnPublicClient,
} from "@surge/earn-sdk";

async function connectMetaMaskForEarn() {
  if (!window.ethereum) throw new Error("MetaMask not installed");

  const [account] = await window.ethereum.request({ method: "eth_requestAccounts" });
  const chainIdHex = await window.ethereum.request({ method: "eth_chainId" });

  if (Number(chainIdHex) !== baseSepolia.id) {
    await window.ethereum.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: "0x14a34" }],
    });
  }

  const publicClient = createSurgeEarnPublicClient("https://sepolia.base.org", baseSepolia);
  const walletClient = createWalletClient({
    chain: baseSepolia,
    transport: custom(window.ethereum),
  });

  return {
    account,
    earn: new SurgeEarnClient({
      publicClient,
      walletClient,
      config: SURGE_BASE_SEPOLIA_CONFIG,
    }),
  };
}

export async function approveAndDeposit(amountUsdc: string) {
  const { account, earn } = await connectMetaMaskForEarn();
  const allowance = await earn.getAllowance(account);
  if (allowance === 0n) {
    await earn.approveMaxUsdc({ account, waitForReceipt: true });
  }
  await earn.deposit({ amountUsdc, account, waitForReceipt: true });
}

export async function withdrawUsdc(amountUsdc: string) {
  const { account, earn } = await connectMetaMaskForEarn();
  await earn.withdrawByUsdc({ amountUsdc, account, waitForReceipt: true });
}
```

## 11) Activity feed (deposit/withdraw history)

```ts
const activity = await earn.getUserActivity("0xYourWalletAddress", {
  fromBlock: 0n,
  includeTimestamps: true,
  limit: 25,
});

// item shape:
// {
//   type: "deposit" | "withdraw",
//   amount,
//   lpTokens,
//   txHash,
//   blockNumber,
//   timestamp
// }
```

You can also query globally:

```ts
const deposits = await earn.listDepositEvents({ fromBlock: 0n, limit: 100 });
const withdrawals = await earn.listWithdrawEvents({ fromBlock: 0n, limit: 100 });
```

## Integration checklist

- Ensure wallet is connected to Base Sepolia (`chainId: 84532`).
- Use a reliable Base Sepolia RPC endpoint.
- Confirm USDC decimals are 6.
- Wait for transaction receipts before refreshing portfolio state.
- Display explorer links for all write transactions.
