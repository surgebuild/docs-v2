---
title: Execution State Machine
description: EVM-based deterministic ledger for BTC-backed liabilities.
---

# ⚙️ Execution State Machine
The **Execution State Machine (ESM)** functions as Surge’s canonical ledger for **BTC-backed liabilities**.  
It connects Bitcoin vaults, signer sets, and stablecoin issuance through deterministic state transitions, ensuring BTC collateral can only move when programmatic conditions are satisfied.

The ESM defines *authorization logic* for Bitcoin movements, while the actual spend construction and signing occur in the **[Deterministic Liquidation](/tech/dvaults-liquidation)** module.

## Canonical Ledger for BTC-Backed Liabilities
The onchain State maintains the **single source of truth** for:
- dVault collateral ratios.
- Active liabilities (stablecoin denominated debt).
- Signer sets and epoch rotations.

It **prevents rehypothecation** by ensuring every Bitcoin UTXO is represented exactly once in system state, binding liabilities directly to on-chain BTC collateral.

## Bitcoin Aware State
The ESM is natively coupled to Bitcoin:
- **Oracle Feeds**: Medianized BTC/USD prices from trusted providers update collateral ratios in real time.
- **Bitcoin Attestations**: Proof-of-inclusion for UTXOs and Taproot spends are submitted to contracts, ensuring the on-chain records mirrors actual Bitcoin state.

This guarantees that liabilities within Surge are always corresponds to **native Bitcoin collateral**, never synthetic or wrapped assets.

## State Commitments and Root Binding
A confirmed state transition finalizes a **state root** that encodes:
- Active vault positions and collateral ratios.
- Signer set and epoch key.
- Stability Pool balances.
- Cross-chain stablecoin flows and reconciliations.

BTC spends from a dVault are only valid if the signer set co-signs under the **aggregate Lin22 Schnorr key** bound to this state root.  This creates a cryptographic anchor - BTC collateral cannot move unless the Execution Program has verified and authorizes it.

## Oracle Integration
The ESM depends on a Native Oracle Hub to monitor BTC/USD prices and enforce collateralization rules.  
- Medianized prices across trusted feeds are used for CR enforcement.  
- Liquidation events are emitted when CR < MinCR, binding signer permissions to liquidation spends.  

## Signer Enforcement
Signer operations are strictly permissioned and event-driven:
- **Signer Enforcement**: Coinbase [cb-mpc](https://github.com/coinbase/cb-mpc) distributed signing rounds for Taproot vault keys.
- **Contract-Gated Authorization**: Signers can only sign if the ESM has emitted a valid event.
- **No Rogue Signing**: Signers do not decide when BTC can move - the ledger enforces it.

This guarantees **programmatic enforcement of BTC custody**, TC moves only when the cryptographic and economic conditions encoded in Surge’s Execution State Machine are met.

:::info
See [Deterministic Liquidation](/tech/dvaults-liquidation) for details on PSBT based execution and signer coordination.
:::