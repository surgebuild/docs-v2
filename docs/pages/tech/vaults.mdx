---
title: dVaults
description: Taproot-based, MAST-committed spend programs that secure BTC
---
import ZoomImage from "../../components/ZoomImage";

# üîê dVaults: Programmable Bitcoin Vaults

A **dVault** is a Bitcoin Taproot UTXO ([BIP341](https://en.bitcoin.it/wiki/BIP_0341)) whose spend conditions are committed via **MAST/Tapscript** ([BIP342](https://en.bitcoin.it/wiki/BIP_0342)).
- **Taproot** commits multiple possible spending conditions inside a single address.
- **MAST (Merkelized Alternative Script Tree)** is to enumerate differnt spending conditions and allow funds to be spent by satisfying any one script. Each script is a leaf in a Merkle tree, and only the executed leaf is revealed during spend. Any unused branches remain hidden.

Surge uses dVaults as its **collateral engine** and BTC always remains on Bitcoin, only moving when one of the pre-committed spend conditions is satisfied.

## How dVaults are Programmed?

A dVault locks BTC in a single encoded public key(PT2R) with multiple **spend paths**:
- **Key Path(Repayment)** - co-signed by the borrower and decentralized signer set using **Lin22 (threshold Schnorr)** via Coinbase [cb-mpc](https://github.com/coinbase/cb-mpc).
- **Script Paths** - additional branches in the vault‚Äôs Tapscript that can spend under specific conditions:
  - **Repayment branch** default close path triggered once repayment is attested by the Execution Program.
  - **Liquidation branch** activated when collateral ratio falls below the minimum threshold.
  - **Timelock branch** a long-term unilateral recovery path for the depositor.

<ZoomImage
  src="/assets/dvault_taproot.png"
  alt="dVault Taproot UTXO"
  width="70%"
  className="mx-auto"
/>

## Core Scripting

- Each vault commits a **tapscript** of spend leaves (tapscripts). Only the executed leaf is revealed during spend; unused branches remain hidden.
- The **repayment path** uses an **aggregate Lin22 Schnorr key** (`cb-mpc(P_user, P_signer_epoch)`) for the standard close flow.
- **Script leaves** define exclusive paths (liquidation, CR checks, timelock, etc.,).

## Spend Paths

- **Repayment** - BTC can be spent via the **key path** by `Lin22(P_user, P_epoch)` once the execution program attests that debt was repaid.
_Enforced by signers + state proofs, the script enforces signatures only._

- **Liquidation** - If CR < MinCR, signers spend via a **CSV gated** liquidation leaf. The spend creates outputs:
   - Delivers discounted BTC to the Stability Pool.
   - Re-locks change output to a new dVault under the borrower‚Äôs control.

_CR check is off-chain; the script enforces signer control + delay._

- **Timelock** - After a defined **CLTV** period, the depositor can unilaterally recover BTC with a dedicated recovery key.

## Script Structures

### 1. Repayment Path (Ledger Validated Unlock)

```bitcoin-script
# Requires depositor + cb-mpc aggregated Lin22 Schnorr key
# Only valid if repayment event is confirmed in execution environment
AND(
    OP_CHECKSIG(user_pubkey),
    OP_CHECKSIG(lin22_epoch_aggkey)
)
```

### 2. Liquidation Path (Micro Liquidations)

```bitcoin-script
# Signers + Stability Pool key can spend BTC if CR < MinCR
AND(
    OP_CHECKSIG(lin22_epoch_aggkey),
    OP_CHECKSIG(stability_pool_key)
)
```

### 3. Timelock Recovery Path

```bitcoin-script
# Depositor regains unilateral control after CLTV expiry
AND(
    OP_CHECKLOCKTIMEVERIFY,
    OP_DROP,
    OP_CHECKSIG(user_recovery_key)
)
```

## Lifecycle

1. **Deposit** - User locks BTC to the Taproot address (key path = `Lin22(P_user, P_epoch)`).
2. **Borrow** - Execution environment issues stablecoins against the attested deposit.
3. **Monitoring** - BTC/USD oracle updates CR, state commits, debts, and Stability Pool balances.
4. **Incremental Liquidations** - If `CR < MinCR`, signers spend via the liquidation leaf. The spend MUST produce:
   - **Stability Pool purchase** - discounted BTC to the Stability Pool.
   - **Relock** - re-locked into a new dVault under user control.
5. **Repayment/Close** - Once repaid, signers co-sign the key-path spend, moving BTC as per user instructions.

## Security Anchors

- **On-chain invariants (script):** Schnorr key verification, `CLTV` timelocks, and MAST-committed branches.
- **Off-chain invariants (state):** CR validation, repayment attestations, liquidation authorization, and signer epoch rotation bound to the execution program's state.
- **Signer tech:** Coinbase **cb-mpc** coordinating **Lin22 (threshold Schnorr)** for Taproot keys. **Hai18 (threshold ECDSA)** only where non Bitcoin interoperability requires it.
- **Execution program consistency:** All Bitcoin spends reference the latest on-chain Execution State, ensuring deterministic reconciliation between BTC vaults and stablecoin liabilities.
